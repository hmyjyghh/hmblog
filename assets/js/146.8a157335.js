(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{587:function(t,a,s){"use strict";s.r(a);var n=s(3),r=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("code",[t._v("requires_grad")]),t._v(" æ˜¯ PyTorch ä¸­å¼ é‡çš„ä¸€ä¸ªé‡è¦å±æ€§ï¼Œç”¨äº"),a("strong",[t._v("æ§åˆ¶æ¢¯åº¦è®¡ç®—å’Œå‚æ•°æ›´æ–°")]),t._v("ã€‚")]),t._v(" "),a("h2",{attrs:{id:"_1-åŸºæœ¬å«ä¹‰"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-åŸºæœ¬å«ä¹‰"}},[t._v("#")]),t._v(" 1. åŸºæœ¬å«ä¹‰")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("requires_grad=True")]),t._v("ï¼š"),a("strong",[t._v("éœ€è¦è®¡ç®—æ¢¯åº¦")]),t._v("ï¼Œå‚ä¸åå‘ä¼ æ’­å’Œå‚æ•°æ›´æ–°")]),t._v(" "),a("li",[a("code",[t._v("requires_grad=False")]),t._v("ï¼š"),a("strong",[t._v("ä¸éœ€è¦è®¡ç®—æ¢¯åº¦")]),t._v("ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¢«å†»ç»“")])]),t._v(" "),a("h2",{attrs:{id:"_2-åœ¨-lora-ä¸­çš„ä½œç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-åœ¨-lora-ä¸­çš„ä½œç”¨"}},[t._v("#")]),t._v(" 2. åœ¨ LoRA ä¸­çš„ä½œç”¨")]),t._v(" "),a("p",[t._v("åœ¨ä½ æ‰‹æ’• LoRA ç±»çš„åœºæ™¯ä¸­ï¼š")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å†»ç»“åŸæ¥çš„å±‚çš„å‚æ•°")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" param "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("base_layer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parameters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  param"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requires_grad "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("\n")])])]),a("p",[t._v("è¿™æ„å‘³ç€ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("âœ… "),a("strong",[t._v("åŸå§‹æƒé‡è¢«å†»ç»“")]),t._v("ï¼Œä¸å‚ä¸è®­ç»ƒ")]),t._v(" "),a("li",[t._v("âœ… "),a("strong",[t._v("åªæœ‰ LoRA çš„é€‚é…å™¨å‚æ•°ä¼šè¢«æ›´æ–°")])]),t._v(" "),a("li",[t._v("âœ… "),a("strong",[t._v("å¤§å¹…å‡å°‘è®­ç»ƒå‚æ•°é‡å’Œå†…å­˜å ç”¨")])])]),t._v(" "),a("h2",{attrs:{id:"_3-å®é™…ç¤ºä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å®é™…ç¤ºä¾‹"}},[t._v("#")]),t._v(" 3. å®é™…ç¤ºä¾‹")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" torch\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nn "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" nn\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å‡è®¾è¿™æ˜¯ä½ çš„åŸå§‹çº¿æ€§å±‚")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoRAWrapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" base_layer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rank"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__init__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("base_layer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" base_layer\n        self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lora_A "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("base_layer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("in_features"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bias"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lora_B "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rank"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" base_layer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out_features"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bias"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å†»ç»“åŸå§‹å±‚å‚æ•°")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" param "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("base_layer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parameters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            param"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requires_grad "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ğŸ¯ å…³é”®æ­¥éª¤ï¼")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# LoRA å‚æ•°é»˜è®¤ requires_grad=True")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ‰€ä»¥åªæœ‰è¿™äº›å‚æ•°ä¼šè¢«è®­ç»ƒ")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forward")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        base_output "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("base_layer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        lora_output "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lora_B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lora_A"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" base_output "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" lora_output\n")])])]),a("h2",{attrs:{id:"_4-éªŒè¯æ•ˆæœ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-éªŒè¯æ•ˆæœ"}},[t._v("#")]),t._v(" 4. éªŒè¯æ•ˆæœ")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# åˆ›å»ºæ¨¡å‹")]),t._v("\nlinear_layer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Linear"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nlora_model "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LoRAWrapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("linear_layer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ£€æŸ¥å‚æ•°çŠ¶æ€")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" param "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" lora_model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("named_parameters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(": requires_grad = ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("param"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requires_grad"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# è¾“å‡ºç¤ºä¾‹ï¼š")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# base_layer.weight: requires_grad = False  # âŒ å†»ç»“")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# base_layer.bias: requires_grad = False    # âŒ å†»ç»“  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# lora_A.weight: requires_grad = True       # âœ… è®­ç»ƒ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# lora_B.weight: requires_grad = True       # âœ… è®­ç»ƒ")]),t._v("\n")])])]),a("h2",{attrs:{id:"_5-ä¸ºä»€ä¹ˆé‡è¦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-ä¸ºä»€ä¹ˆé‡è¦"}},[t._v("#")]),t._v(" 5. ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("å‚æ•°æ•ˆç‡")]),t._v("ï¼šåªè®­ç»ƒå°‘é‡ LoRA å‚æ•°ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ¨¡å‹")]),t._v(" "),a("li",[a("strong",[t._v("é˜²æ­¢ç¾éš¾æ€§é—å¿˜")]),t._v("ï¼šä¿æŒé¢„è®­ç»ƒæƒé‡ä¸å˜")]),t._v(" "),a("li",[a("strong",[t._v("å†…å­˜ä¼˜åŒ–")]),t._v("ï¼šå‡å°‘æ¢¯åº¦è®¡ç®—çš„å†…å­˜å¼€é”€")]),t._v(" "),a("li",[a("strong",[t._v("è®­ç»ƒç¨³å®šæ€§")]),t._v("ï¼šé¿å…ç ´åé¢„è®­ç»ƒçš„çŸ¥è¯†")])]),t._v(" "),a("p",[t._v("è¿™å°±æ˜¯ LoRA èƒ½å¤Ÿé«˜æ•ˆå¾®è°ƒå¤§æ¨¡å‹çš„æ ¸å¿ƒæœºåˆ¶ï¼")])])}),[],!1,null,null,null);a.default=r.exports}}]);