(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{505:function(t,s,a){"use strict";a.r(s);var e=a(3),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"mcp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mcp"}},[t._v("#")]),t._v(" MCP")]),t._v(" "),s("h3",{attrs:{id:"模型上下文协议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模型上下文协议"}},[t._v("#")]),t._v(" 模型上下文协议")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/modelcontextprotocol",target:"_blank",rel:"noopener noreferrer"}},[t._v("github 上的仓库地址"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[s("p",[t._v("MCP，简单来说，就是AI大模型的标准化工具箱")])]),t._v(" "),s("li",[s("p",[t._v("MCP server本质上是运行在电脑上的一段nodejs或者Python程序")])]),t._v(" "),s("li",[s("p",[t._v("MCP server有两种形式，@tool，@resource。")])]),t._v(" "),s("li",[s("p",[t._v("@mcp.tool()的话是类似于"),s("code",[t._v("post请求")]),t._v(", 会产生副作用, eg: 写入等操作;")]),t._v(" "),s("ul",[s("li",[t._v("@mcp.tool()装饰器是给下面的函数增加功能")]),t._v(" "),s("li",[t._v("函数里面的注释需要保留，目的是"),s("code",[t._v("使用自然语言告诉AI大模型")]),t._v("，"),s("code",[t._v("可以帮助大模型更精准的调用MCP工具")])])])]),t._v(" "),s("li",[s("p",[t._v("@mcp.resource()的话，嗯，就是类似于"),s("code",[t._v("get请求")]),t._v("，只会获得获得只读数据，然后不会产生副作用。")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"/hmblog/images/mcp/mcp-server-2.png",alt:"MCP Server"}})]),t._v(" "),s("h3",{attrs:{id:"mcp协议的底层原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mcp协议的底层原理"}},[t._v("#")]),t._v(" MCP协议的底层原理")]),t._v(" "),s("blockquote",[s("p",[t._v("众所周知，DeepSeek R1是不支持Function Calling")])]),t._v(" "),s("ul",[s("li",[t._v("5ire 选DeepSeek R1模型报错, 不支持Function Calling")]),t._v(" "),s("li",[t._v("cline客户端，选择DeepSeek R1, 调用function calling 是正常的")]),t._v(" "),s("li",[t._v("cline客户端是直接把各种tools函数写在了"),s("code",[t._v("系统提示词")]),t._v("里")]),t._v(" "),s("li",[t._v("5ire, 5ire并没有把MCP信息放到系统提示词里, 这个AI客户端依赖了模型的function call功能")]),t._v(" "),s("li",[t._v("5ire， 一段json里使用了tools 字段、"),s("code",[t._v("也就是依赖了模型的function call功能")])])]),t._v(" "),s("p",[s("strong",[t._v("MCP与AI对接的时候, 根据客户端的实现方式不同,对接方式也有所不同")])]),t._v(" "),s("h3",{attrs:{id:"上面是mcp和function-call的关系是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上面是mcp和function-call的关系是什么"}},[t._v("#")]),t._v(" 上面是MCP和function call的关系是什么?")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("所以MCP协议是一种灵活的协议,这也解释了为什么MCP的道用性会这么强")])]),t._v(" "),s("li",[s("p",[t._v("根据客户端实现的不同, MCP可以依赖function call, 也可以不依赖function call")])])]),t._v(" "),s("h3",{attrs:{id:"mcp-底层调用原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mcp-底层调用原理"}},[t._v("#")]),t._v(" MCP 底层调用原理")]),t._v(" "),s("p",[s("strong",[t._v("Client 调用完MCP server之后拿到返回结果, 加上之前的上下文,再次传递给大模型, 大模型进行最后的整理,然后把最终结果呈现给用户")])]),t._v(" "),s("h3",{attrs:{id:"mcp-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mcp-server"}},[t._v("#")]),t._v(" MCP Server")]),t._v(" "),s("p",[t._v("作为AI与外部工具的中间层")]),t._v(" "),s("p",[s("img",{attrs:{src:"/hmblog/images/mcp/mcp-server.png",alt:"MCP Server"}})]),t._v(" "),s("h3",{attrs:{id:"mcp-server-发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mcp-server-发布"}},[t._v("#")]),t._v(" MCP Server 发布")]),t._v(" "),s("p",[t._v("通过UV发布一个工MCP工具到Pypi 官网")]),t._v(" "),s("ul",[s("li",[t._v('uv add "mcp[cli]"')]),t._v(" "),s("li",[t._v("uv publish --token")])]),t._v(" "),s("h3",{attrs:{id:"mcp-server有三种协议-stdio-sse还有streamable-http"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mcp-server有三种协议-stdio-sse还有streamable-http"}},[t._v("#")]),t._v(" MCP server有三种协议, STDIO, SSE还有Streamable Http")]),t._v(" "),s("p",[s("img",{attrs:{src:"/hmblog/images/mcp/stdio.jpg",alt:"MCP STDIO"}})]),t._v(" "),s("h3",{attrs:{id:"mcp-服务启动和使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mcp-服务启动和使用"}},[t._v("#")]),t._v(" MCP 服务启动和使用")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" contextlib "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" AsyncExitStack\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mcp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ClientSession"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" StdioServerParameters\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdio "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" stdio_client\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 初始化客户端")]),t._v("\nexit_stack "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AsyncExitStack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nserver_params "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" StdioServerParameters"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    command"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    args"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("server_script_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    env"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动 MCP 服务器并建立通信")]),t._v("\nstdio_transport "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" exit_stack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enter_async_context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    stdio_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("server_params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nself"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stdio_transport\nself"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" exit_stack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enter_async_context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    ClientSession"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("initialize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列出 MCP 服务器上的工具")]),t._v("\nresponse "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list_tools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntools "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tools\n")])])]),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fastmcp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" FastMCP\n\nmcp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" FastMCP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"amap-maps"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);